<div class="zen-container">
  
  @if (notification(); as msg) {
    <div class="notification-scroll" role="alert">
      <span class="symbol">ğŸ€„</span> {{ msg }}
    </div>
  }

  <header class="header-section">
    <div class="title-group">
      <h1>DÅjÅ des TÃ¢ches</h1>
      <span class="japanese-subtitle">ã‚¿ã‚¹ã‚¯ã®é“å ´</span>
    </div>
    <p class="subtitle">"La clartÃ© de l'esprit prÃ©cÃ¨de l'action prÃ©cise."</p>
  </header>

  <section class="stats-wrapper">
    <app-task-stats />
  </section>

  <div class="scroll-container">
    <div class="roll-end top"></div>
    
    <div class="mission-scroll-form">
      <h3>ğŸ“œ Nouvel Ordre de Mission</h3>
      
      <div class="input-wrapper">
        <label>Objectif</label>
        <input type="text" 
               [(ngModel)]="newTask.title" 
               (keyup.enter)="onAddTask()"
               placeholder="Ex: DÃ©fendre le chÃ¢teau du Nord..." 
               class="zen-input title-input">
      </div>
      
      <div class="input-wrapper">
        <label>StratÃ©gie</label>
        <textarea [(ngModel)]="newTask.description" 
                  (keydown.control.enter)="onAddTask()"
                  placeholder="DÃ©tails tactiques..." 
                  rows="2" 
                  class="zen-input desc-input"></textarea>
      </div>

      <div class="seal-wrapper">
        <button class="btn-hanko-seal" 
                (click)="onAddTask()" 
                [disabled]="!newTask.title.trim()"
                title="Sceller l'ordre">
          <span class="kanji-seal">æ‰¿èª</span>
          <span class="text-seal">SCELLER</span>
        </button>
      </div>
    </div>

    <div class="roll-end bottom"></div>
  </div>

  @if (editingTask(); as task) {
    <div class="modal-backdrop" (click)="closeEdit()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <app-task-edit 
          [initialTitle]="task.title" 
          [initialDescription]="task.description || ''"
          (saveTask)="onSaveEdit($event)"
          (cancel)="closeEdit()">
        </app-task-edit>
      </div>
    </div>
  }

  <div class="samurai-grid">
    @for (task of tasks(); track task.id) {
      <div class="samurai-card fade-in-up" 
           (click)="onToggleComplete(task.id)"
           [class.completed-card]="task.completed"
           [class.illuminated-card]="task.isHighlighted"> 
           
        <div class="card-visual">
          <img [src]="'https://api.dicebear.com/9.x/adventurer/svg?seed=' + task.id + '&backgroundColor=b6e3f4,c0aede,d1d4f9'" 
               alt="Avatar" 
               loading="lazy"
               class="samurai-img">
          @if (task.isHighlighted) { <div class="glow-aura"></div> }
        </div>

        <div class="card-content">
          <div class="content-top">
            <h3 class="task-title">{{ task.title }}</h3>
            <span class="status-dot" [class.done]="task.completed"></span>
          </div>
          
          @if (task.description) {
            <p class="task-desc">{{ task.description }}</p>
          }
        </div>

        <div class="card-actions">
          <button class="action-btn gold" 
                  (click)="onToggleHighlight($event, task.id)" 
                  [class.active-star]="task.isHighlighted">
            {{ task.isHighlighted ? 'ğŸŒŸ' : 'â­' }}
          </button>
          
          <button class="action-btn ink" (click)="onStartEdit($event, task)">
            âœ’ï¸
          </button>
          
          <button class="action-btn red" (click)="onDelete($event, task.id)">
            âš”ï¸
          </button>
        </div>
      </div>
    } @empty {
      <div class="empty-dojo">
        <span class="empty-icon">ğŸƒ</span>
        <p>Le vent souffle... Aucune mission Ã  l'horizon.</p>
      </div>
    }
  </div>
</div>