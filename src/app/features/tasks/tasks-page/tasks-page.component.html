<div class="zen-container">
  
  @if (notification(); as msg) {
    <div class="notification-scroll">
      <span class="symbol">ğŸ€„</span> {{ msg }}
    </div>
  }

  <header class="header-section">
    <h1>DÅjÅ des TÃ¢ches</h1>
    <p class="subtitle">La clartÃ© de l'esprit prÃ©cÃ¨de l'action</p>
  </header>

  <app-task-stats />

  <div class="mission-scroll-form">
    <h3>ğŸ“œ Nouvel Ordre de Mission</h3>
    
    <div class="form-group">
      <input type="text" 
             [(ngModel)]="newTask.title" 
             (keyup.enter)="onAddTask()"
             placeholder="Titre de la mission..." 
             class="zen-input title-input">
    </div>
    
    <div class="form-group">
      <textarea [(ngModel)]="newTask.description" 
                (keydown.control.enter)="onAddTask()"
                placeholder="DÃ©tails stratÃ©giques (optionnel)..." 
                rows="2" 
                class="zen-input desc-input"></textarea>
    </div>

    <button class="btn-hanko-large" (click)="onAddTask()" [disabled]="!newTask.title.trim()">
      SCELLER L'ORDRE
    </button>
  </div>

  @if (editingTask(); as task) {
    <div class="modal-overlay">
      <app-task-edit 
        [initialTitle]="task.title" 
        [initialDescription]="task.description || ''"
        (saveTask)="onSaveEdit($event)"
        (cancel)="closeEdit()">
      </app-task-edit>
    </div>
  }

  <div class="samurai-grid">
    
    @for (task of tasks(); track task.id) {
      <div class="samurai-card" 
           (click)="onToggleComplete(task.id)"
           [class.completed-card]="task.completed"
           [class.illuminated-card]="task.isHighlighted"> 
           
        <div class="card-visual">
          <img [src]="'https://api.dicebear.com/9.x/adventurer/svg?seed=' + task.id + '&backgroundColor=b6e3f4,c0aede,d1d4f9'" 
               alt="Samurai Avatar" 
               class="samurai-img">
          
          @if (task.isHighlighted) {
            <div class="glow-aura"></div>
          }
        </div>

        <div class="card-content">
          <h3 class="task-title">{{ task.title }}</h3>
          
          @if (task.description) {
            <p class="task-desc">{{ task.description }}</p>
          }

          <div class="tags">
            <span class="status-badge" [class.done]="task.completed">
              {{ task.completed ? 'Vaincu' : 'En cours' }}
            </span>
          </div>
        </div>

        <div class="card-actions">
          <button class="action-btn gold" 
                  (click)="onToggleHighlight($event, task.id)" 
                  [class.active-star]="task.isHighlighted"
                  title="Illuminer (PrioritÃ©)">
            {{ task.isHighlighted ? 'ğŸŒŸ' : 'â­' }}
          </button>
          
          <button class="action-btn ink" 
                  (click)="onStartEdit($event, task)" 
                  title="StratÃ©gie">
            âœ’ï¸
          </button>
          
          <button class="action-btn red" 
                  (click)="onDelete($event, task.id)" 
                  title="ExÃ©cuter">
            âš”ï¸
          </button>
        </div>

      </div>
    } @empty {
      <div class="empty-dojo">
        <p>Le calme rÃ¨gne dans le dojo...</p>
      </div>
    }
  </div>
  
  <div class="footer-decoration">
    <span class="wave-pattern"></span>
  </div>
</div>